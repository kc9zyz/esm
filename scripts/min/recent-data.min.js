var options={scaleShowGridLines:true,scaleGridLineColor:"rgba(255,255,255,.05)",scaleFontColor:"rgba(255,255,255,.8)",scaleLabel:"          <%=value%>",scaleGridLineWidth:1,scaleShowHorizontalLines:true,scaleShowVerticalLines:true,bezierCurve:true,bezierCurveTension:.4,pointDot:true,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:5,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,maintainAspectRatio:true,responsive:true,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};var waypoint=new Waypoint({element:document.getElementById("last-hour-data-chart"),handler:function(){getLastHourData();this.destroy()},offset:"90%"});getLastHourData=function(){if(typeof this.firstTime=="undefined"){this.firstTime=1;$.ajax({url:"data/?asset=recent-data",success:function(result){updateLastHour("waypoint",[result.times,result.output])}})}};getLastData=function(){};updateLastHour=function(caller,points){if(typeof this.firstTime=="undefined"){this.firstTime=1}if(caller=="waypoint"&&this.firstTime==1){var lastHourData={labels:points[0],datasets:[{label:"Watts",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:points[1]}]};Chart.types.Line.extend({name:"LineAlt",draw:function(){Chart.types.Line.prototype.draw.apply(this,arguments);var ctx=this.chart.ctx;ctx.save();ctx.textAlign="center";ctx.textBaseline="bottom";ctx.fillStyle=this.options.scaleFontColor;var x=this.scale.xScalePaddingLeft*.4;var y=this.chart.height/2;ctx.translate(x,y);ctx.rotate(-90*Math.PI/180);ctx.fillText("Watts",0,0);ctx.restore()}});var ctx=document.getElementById("last-hour-data-chart");var container=document.getElementById("recentCol");ctx.width=container.clientWidth;this.lastHourChart=new Chart(ctx.getContext("2d")).LineAlt(lastHourData,options);setInterval(function(){getLastData()},3e3);this.firstTime=0}else if(caller=="time"&&this.firstTime==0){var currentPoints=this.lastHourChart.datasets[0].points;if(currentPoints[currentPoints.length-1].label!=points[0]){this.lastHourChart.removeData();this.lastHourChart.addData([parseInt(points[1])],points[0])}}};$("#currentHour").on("click",function(event){$("#currentDrop").html("Select Range - "+$(this).text()+' <span class="caret"></span>')});$("#currentDay").on("click",function(event){$("#currentDrop").html("Select Range - "+$(this).text()+' <span class="caret"></span>')});$("#currentWeek").on("click",function(event){$("#currentDrop").html("Select Range - "+$(this).text()+' <span class="caret"></span>')});
