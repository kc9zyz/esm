var historicalDuration="month";var options={scaleShowGridLines:true,scaleGridLineColor:"rgba(255,255,255,.05)",scaleFontColor:"rgba(255,255,255,.8)",scaleLabel:"          <%=value%>",scaleGridLineWidth:1,scaleShowHorizontalLines:true,scaleShowVerticalLines:true,bezierCurve:true,bezierCurveTension:.4,pointDot:true,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:5,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,maintainAspectRatio:true,responsive:true,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',multiTooltipTemplate:"<%= datasetLabel %> - <%= value %>"};var waypoint=new Waypoint({element:document.getElementById("last-hour-data-chart"),handler:function(){getHistoricalData();this.destroy()},offset:"90%"});getHistoricalData=function(){var maxLength=Math.floor($(window).width()/70);$.ajax({url:"data/?asset=historical-data&duration="+historicalDuration+"&points="+maxLength,success:function(result){var times=[];for(entry in result.times){var time=new Date(result.times[entry]);switch(historicalDuration){case"month":times[entry]=time.toLocaleDateString();break;case"year":times[entry]=time.toLocaleDateString();break;case"all":times[entry]=time.toLocaleDateString();break}}updateHistorical([times,result.panelOutputs,result.shingleOutputs]);if(result.panelkWh>2e3){result.panelkWh/=1e3;result.panelkWh=result.panelkWh.toPrecision(3);$("#historicalPanel").html(""+result.panelkWh+" MWh")}else{$("#historicalPanel").html(""+result.panelkWh+" kWh")}if(result.shinglekWh>2e3){result.shinglekWh/=1e3;result.shinglekWh=result.shinglekWh.toPrecision(3);$("#historicalShingle").html(""+result.shinglekWh+" MWh")}else{$("#historicalShingle").html(""+result.shinglekWh+" kWh")}}})};updateHistorical=function(points){var historicalData={labels:points[0],datasets:[{label:"Panel",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:points[1]},{label:"Shingle",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(51,87,205,1)",pointColor:"rgba(51,87,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:points[2]}]};Chart.types.Line.extend({name:"LineAlt",draw:function(){Chart.types.Line.prototype.draw.apply(this,arguments);var ctx=this.chart.ctx;ctx.save();ctx.textAlign="center";ctx.textBaseline="bottom";ctx.fillStyle=this.options.scaleFontColor;var x=this.scale.xScalePaddingLeft*.4;var y=this.chart.height/2;ctx.translate(x,y);ctx.rotate(-90*Math.PI/180);ctx.fillText("Watts",0,0);ctx.restore()}});var ctx=document.getElementById("historical-data-chart");var container=document.getElementById("historicalCol");ctx.width=container.clientWidth;if(this.historicalChart){this.historicalChart.destroy()}this.historicalChart=new Chart(ctx.getContext("2d")).LineAlt(historicalData,options);this.firstTime=0};$("#historicalMonth").on("click",function(event){$("#historicalDrop").html("Select Range - "+$(this).text()+' <span class="caret"></span>');historicalDuration="month";getHistoricalData()});$("#historicalYear").on("click",function(event){$("#historicalDrop").html("Select Range - "+$(this).text()+' <span class="caret"></span>');historicalDuration="year";getHistoricalData()});$("#historicalAll").on("click",function(event){$("#historicalDrop").html("Select Range - "+$(this).text()+' <span class="caret"></span>');historicalDuration="all";getHistoricalData()});
